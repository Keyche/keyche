<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyche - Redis Connections</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <style>
        body {
            padding: 20px;
        }
        .tab a {
            display: flex;
            align-items: center;
        }
        .tab a .close {
            margin-left: 8px;
            color: red;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Keyche - Cache Browser</h2>
        <ul id="connectionTabs" class="tabs">
            <li class="tab col s3"><a href="#add-connection">Add Connection</a></li>
        </ul>

        <!-- Tab for Adding a New Connection -->
        <div id="add-connection" class="col s12">
            <h4>Add New Cache Connection</h4>
            <form id="connectionForm">
                <div class="input-field">
                    <input id="connectionName" type="text" required>
                    <label for="connectionName">Connection Name</label>
                </div>
                <div class="input-field">
                    <input id="host" type="text" required>
                    <label for="host">Host</label>
                </div>
                <div class="input-field">
                    <input id="port" type="number" required>
                    <label for="port">Port</label>
                </div>
                <div class="input-field">
                    <input id="password" type="password">
                    <label for="password">Password (optional)</label>
                </div>
                <button class="btn waves-effect waves-light" type="submit">Add Connection</button>
            </form>
        </div>

        <!-- Dynamic Content for Each Connection -->
        <div id="connectionContents">
            <!-- Connection-specific content will appear here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const connectionForm = document.getElementById('connectionForm');
            const connectionTabs = document.getElementById('connectionTabs');
            const connectionContents = document.getElementById('connectionContents');
            const connections = {};

            // Initialize tabs (Materialize)
            M.Tabs.init(document.querySelector('.tabs'));

            // Add a new connection
            connectionForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const name = document.getElementById('connectionName').value;
                const host = document.getElementById('host').value;
                const port = document.getElementById('port').value;
                const password = document.getElementById('password').value;

                if (connections[name]) {
                    alert('Connection name already exists!');
                    return;
                }

                connections[name] = { host, port, password };
                addConnectionTab(name);
                connectionForm.reset();
            });

            // Add a new tab for the connection
            function addConnectionTab(name) {
                const tabId = `tab-${name}`;

                // Add tab button
                const tabButton = document.createElement('a');
                tabButton.href = `#${tabId}`;
                tabButton.innerHTML = `${name} <span class="close">&times;</span>`;
                tabButton.className = 'tab col s3';

                const tabListItem = document.createElement('li');
                tabListItem.className = 'tab col s3';
                tabListItem.appendChild(tabButton);

                connectionTabs.appendChild(tabListItem);

                // Add tab content
                const tabContent = document.createElement('div');
                tabContent.id = tabId;
                tabContent.className = 'col s12';
                tabContent.innerHTML = ` <p>Host: ${connections[name].host} Port: ${connections[name].port}</p> `;


                tabContent.innerHTML += `<iframe src="connection.html" width="100%" height="500px"></iframe>`;


                connectionContents.appendChild(tabContent);

                // Reinitialize tabs
                M.Tabs.init(document.querySelector('.tabs'));

                // Add event listener for close button
                tabButton.querySelector('.close').addEventListener('click', (e) => {
                    e.preventDefault();
                    removeConnection(name);
                });
            }

            // Remove a connection
            function removeConnection(name) {
                delete connections[name];

                // Remove tab button and content
                const tabButton = document.querySelector(`.tab a[href="#tab-${name}"]`).parentElement;
                const tabContent = document.getElementById(`tab-${name}`);

                if (tabButton) tabButton.remove();
                if (tabContent) tabContent.remove();

                // Reinitialize tabs
                M.Tabs.init(document.querySelector('.tabs'));
            }
        });
    </script>
</body>
</html>
